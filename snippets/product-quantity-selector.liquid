{%- comment -%}
  Quantity selector with optional volume pricing buttons.
  When pricing_mode is 'tiered' and product is tier-eligible, shows pricing tier buttons.
  Otherwise shows a simple +/- quantity selector.
  Usage: {% render 'product-quantity-selector', product: product, section: section, is_tier_eligible: is_tier_eligible %}
{%- endcomment -%}

{%- liquid
  assign show_tiers = false
  if settings.pricing_mode == 'tiered' and is_tier_eligible
    assign show_tiers = true
  endif
  assign selected_variant = product.selected_or_first_available_variant
-%}

<div class="product__quantity-selector" data-quantity-selector>
  <label class="product__option-label">Quantity</label>

  {%- if show_tiers -%}
    {%- liquid
      assign unit_price = selected_variant.price
      assign compare_price = selected_variant.compare_at_price | default: unit_price
      assign tier_2_price = settings.tier_2_price | times: 100
      assign tier_3_price = settings.tier_3_price | times: 100

      assign savings_1 = compare_price | minus: unit_price

      assign compare_total_2 = compare_price | times: 2
      assign tier_2_total = tier_2_price | times: 2
      assign savings_2 = compare_total_2 | minus: tier_2_total

      assign compare_total_3 = compare_price | times: 3
      assign tier_3_total = tier_3_price | times: 3
      assign savings_3 = compare_total_3 | minus: tier_3_total
    -%}
    <div class="product__quantity-options" data-quantity-options>
      <button
        type="button"
        class="product__qty-btn product__qty-btn--active"
        data-qty-btn
        data-quantity="1"
        data-unit-price="{{ unit_price }}"
      >
        <span class="product__qty-number">1</span>
        <span class="product__qty-price">{{ unit_price | money_without_trailing_zeros }}</span>
        {%- if savings_1 > 0 -%}
          <span class="product__qty-note">Save {{ savings_1 | money_without_trailing_zeros }}</span>
        {%- endif -%}
      </button>

      <button
        type="button"
        class="product__qty-btn"
        data-qty-btn
        data-quantity="2"
        data-unit-price="{{ tier_2_price }}"
      >
        <span class="product__qty-number">2</span>
        <span class="product__qty-price">{{ tier_2_price | money_without_trailing_zeros }} each</span>
        <span class="product__qty-note">Save {{ savings_2 | money_without_trailing_zeros }} total</span>
        {%- if section.settings.tier_2_badge != blank -%}
          <span class="product__qty-badge">{{ section.settings.tier_2_badge }}</span>
        {%- endif -%}
      </button>

      <button
        type="button"
        class="product__qty-btn"
        data-qty-btn
        data-quantity="3"
        data-unit-price="{{ tier_3_price }}"
      >
        <span class="product__qty-number">3+</span>
        <span class="product__qty-price">{{ tier_3_price | money_without_trailing_zeros }} each</span>
        {%- if section.settings.tier_3_badge != blank -%}
          <span class="product__qty-note">{{ section.settings.tier_3_badge }}</span>
        {%- endif -%}
      </button>
    </div>
  {%- else -%}
    <div class="product__quantity-simple" data-quantity-simple>
      <button type="button" class="product__qty-minus" data-qty-minus aria-label="Decrease quantity">-</button>
      <input
        type="number"
        name="quantity"
        value="1"
        min="1"
        class="product__qty-input"
        data-qty-input
        aria-label="Quantity"
      >
      <button type="button" class="product__qty-plus" data-qty-plus aria-label="Increase quantity">+</button>
    </div>
  {%- endif -%}

  <input type="hidden" name="quantity" value="1" data-quantity-input>
</div>
