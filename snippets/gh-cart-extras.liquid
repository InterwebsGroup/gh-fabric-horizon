{% comment %}
  Giant Hoodies Cart Extras
  Renders upsell messaging based on hoodie count in cart.
  Usage:
    {% render 'gh-cart-extras', part: 'top' %}  — upsell banner
{% endcomment %}

{% case part %}
{% when 'top' %}

  {%- comment -%} ——— Hoodie Count ——— {%- endcomment -%}
  {%- liquid
    assign hoodie_count = 0

    for item in cart.items
      assign is_excluded = false
      for tag in item.product.tags
        assign tag_strip = tag | strip
        if tag_strip == settings.tier_exclude_tag
          assign is_excluded = true
          break
        endif
      endfor

      unless is_excluded
        assign item_type = item.product.type | downcase
        if item_type == 'hoodie'
          assign hoodie_count = hoodie_count | plus: item.quantity
        endif
      endunless
    endfor
  -%}

  {%- comment -%} ——— Upsell Banner ——— {%- endcomment -%}
  {%- if settings.cart_upsell_enabled -%}
    {%- liquid
      if settings.pricing_mode == 'flat'
        assign upsell_msg = settings.upsell_flat_mode
        assign show_cta = false
      else
        assign show_cta = true
        case hoodie_count
          when 0
            assign upsell_msg = settings.upsell_0_hoodies
          when 1
            assign upsell_msg = settings.upsell_1_hoodie
          when 2
            assign upsell_msg = settings.upsell_2_hoodies
          else
            assign tier_savings = settings.tier_retail_price | minus: settings.tier_3_price
            assign upsell_msg = 'Save $' | append: tier_savings | append: ' more by adding another hoodie :)'
            assign show_cta = false
        endcase
      endif
    -%}

    <div class="gh-cart-upsell">
      <p class="gh-cart-upsell__msg">
        {{- upsell_msg -}}
        {%- if show_cta -%}
          <a href="{{ settings.upsell_cta_url | default: '/collections/hoodies' }}" class="gh-cart-upsell__cta">{{ settings.upsell_cta_text | default: 'Browse Hoodies →' }}</a>
        {%- endif -%}
      </p>
    </div>
  {%- endif -%}

{% endcase %}
