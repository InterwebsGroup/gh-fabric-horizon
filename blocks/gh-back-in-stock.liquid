{%- liquid
  assign block_settings = block.settings
  assign product = closest.product
  assign selected_variant = product.selected_or_first_available_variant
-%}

{% if settings.back_in_stock_enabled %}
  <div
    class="gh-back-in-stock spacing-style"
    style="{% render 'spacing-style', settings: block_settings %}"
    data-product-id="{{ product.id }}"
    data-variant-id="{{ selected_variant.id }}"
    {{ block.shopify_attributes }}
  >
    {%- unless selected_variant.available -%}
      <div class="gh-back-in-stock__form-wrapper" id="BackInStock-{{ section.id }}">
        <p class="gh-back-in-stock__heading">Get Notified When It's Back</p>
        <p class="gh-back-in-stock__body">Enter your email and we'll let you know the moment this hoodie is available again.</p>
        <form class="gh-back-in-stock__form" data-back-in-stock-form>
          <input
            type="email"
            name="email"
            placeholder="{{ settings.back_in_stock_placeholder }}"
            required
            class="gh-back-in-stock__email"
            aria-label="{{ settings.back_in_stock_placeholder }}"
          >
          <input type="hidden" name="product_id" value="{{ product.id }}">
          <input type="hidden" name="variant_id" value="{{ selected_variant.id }}">
          <button type="submit" class="gh-back-in-stock__submit button button--primary">
            {{ settings.back_in_stock_button_text }}
          </button>
        </form>
        <p class="gh-back-in-stock__success" style="display: none;">
          {{ settings.back_in_stock_success_msg }}
        </p>
      </div>
    {%- endunless -%}
  </div>
{% endif %}

{{ 'gh-back-in-stock.js' | asset_url | script_tag }}

{% stylesheet %}
  .gh-back-in-stock__form-wrapper {
    padding: 16px;
    background: rgb(var(--color-foreground-rgb) / 0.03);
    border-radius: 8px;
  }

  .gh-back-in-stock__heading {
    margin: 0 0 4px;
    font-weight: 600;
    font-size: var(--font-paragraph--size);
    font-family: var(--font-body--family);
  }

  .gh-back-in-stock__body {
    margin: 0 0 12px;
    font-size: var(--font-size--sm, 0.875rem);
    color: rgb(var(--color-foreground-rgb) / 0.65);
  }

  .gh-back-in-stock__form {
    display: flex;
    gap: 8px;
  }

  .gh-back-in-stock__email {
    flex: 1;
    padding: var(--input-padding, 10px 12px);
    border: var(--style-border-width-inputs, 1px) solid rgb(var(--color-foreground-rgb) / 0.15);
    border-radius: var(--style-border-radius-inputs, 8px);
    font-size: var(--font-paragraph--size);
    font-family: var(--font-body--family);
    background: var(--color-background);
    color: var(--color-foreground);
  }

  .gh-back-in-stock__email:focus {
    outline: none;
    border-color: var(--color-primary);
  }

  .gh-back-in-stock__submit {
    white-space: nowrap;
    flex-shrink: 0;
  }

  .gh-back-in-stock__success {
    margin: 12px 0 0;
    font-size: var(--font-size--sm, 0.875rem);
    color: var(--color-instock, #7a9c6d);
    font-weight: 500;
  }

  @media screen and (max-width: 749px) {
    .gh-back-in-stock__form {
      flex-direction: column;
    }
  }
{% endstylesheet %}

{% schema %}
{
  "name": "GH Back in Stock",
  "tag": null,
  "settings": [
    {
      "type": "paragraph",
      "content": "Shows email capture when a variant is sold out. Configure text in Theme Settings > Giant Hoodies Settings > Back in Stock Notifications."
    },
    {
      "type": "header",
      "content": "Padding"
    },
    {
      "type": "range",
      "id": "padding-block-start",
      "label": "Top",
      "min": 0,
      "max": 100,
      "step": 1,
      "unit": "px",
      "default": 0
    },
    {
      "type": "range",
      "id": "padding-block-end",
      "label": "Bottom",
      "min": 0,
      "max": 100,
      "step": 1,
      "unit": "px",
      "default": 0
    },
    {
      "type": "range",
      "id": "padding-inline-start",
      "label": "Left",
      "min": 0,
      "max": 100,
      "step": 1,
      "unit": "px",
      "default": 0
    },
    {
      "type": "range",
      "id": "padding-inline-end",
      "label": "Right",
      "min": 0,
      "max": 100,
      "step": 1,
      "unit": "px",
      "default": 0
    }
  ],
  "presets": [
    {
      "name": "GH Back in Stock",
      "category": "Giant Hoodies"
    }
  ]
}
{% endschema %}
